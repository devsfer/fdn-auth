<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile Preview</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBFippTUHmMjLDnxC3teVgv3QoZLA7e2po",
      authDomain: "sso-authentication-d474d.firebaseapp.com",
      projectId: "sso-authentication-d474d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        document.getElementById("profile").innerHTML = "<p>You are not logged in. <a href='/login.html'>Log in</a></p>";
        return;
      }

      const uid = user.uid;
      const snap = await getDoc(doc(db, "students", uid));
      if (snap.exists()) {
        const data = snap.data();
        document.getElementById("profile").innerHTML = `
          <h2>${data.preferredName}</h2>
          <p><strong>Email:</strong> ${data.email}</p>
          <p><strong>Pronouns:</strong> ${data.pronouns}</p>
          <p><strong>Role:</strong> ${data.role}</p>
          ${data.photoUrl ? `<img src="${data.photoUrl}" style="max-width: 150px; border-radius: 8px;" />` : ''}
          <br/><br/>
          <button onclick="logout()">Logout</button>
        `;
      } else {
        document.getElementById("profile").innerHTML = "<p>No profile data found.</p>";
      }
    });

    window.logout = () => {
      signOut(auth).then(() => {
        location.href = "/login.html";
      });
    };
  </script>
</head>
<body>
  <div id="profile">
    <p>Loading...</p>
  </div>
</body>
</html>
